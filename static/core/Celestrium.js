// Generated by CoffeeScript 1.7.1

/*

only module that needs to be included by a user's requirejs main script.
also loads all the libraries with global definitions.
exposes an object with an `init` function which takes two arguments.

  1. dictionary of plugins
    - keys are singleton plugin requirejs paths
    - values are the arguments to that plugin's factory function
  2. callback
    - guaranteed to be called *after* all instances are created
      as well as globally defined libraries
 */

(function() {
  var globalLibs,
    __slice = [].slice;

  requirejs.config({
    shim: {
      "../lib/jquery.typeahead": ["./jquery"],
      "../lib/backbone": ["./underscore"],
      "../lib/VisualSearch/visualsearch": {
        deps: ["../jquery", "./jquery.ui.autocomplete", "./jquery.ui.core", "./jquery.ui.menu", "./jquery.ui.position", "./jquery.ui.widget", "../underscore", "../backbone"],
        exports: 'VS'
      },
      "../lib/VisualSearch/jquery.ui.core": ["../jquery"],
      "../lib/VisualSearch/jquery.ui.position": ["../jquery"],
      "../lib/VisualSearch/jquery.ui.widget": ["../jquery"],
      "../lib/VisualSearch/jquery.ui.menu": ["./jquery.ui.core", "./jquery.ui.position", "./jquery.ui.widget"],
      "../lib/VisualSearch/jquery.ui.autocomplete": ["./jquery.ui.core", "./jquery.ui.menu", "./jquery.ui.position", "./jquery.ui.widget"],
      "../lib/colorPicker/jquery.colorPicker": ["../jquery"],
      '../lib/chardinjs.min': ["./jquery"],
      '../lib/typeaheadjs/typeahead.bundle.min': ["../jquery"]
    }
  });

  globalLibs = ['../lib/jquery', '../lib/underscore', '../lib/backbone', '../lib/d3', '../lib/less', '../lib/VisualSearch/visualsearch', '../lib/colorPicker/jquery.colorPicker', '../lib/chardinjs.min', '../lib/typeaheadjs/handlebars', '../lib/typeaheadjs/typeahead.bundle.min'];

  define(globalLibs, function() {
    return {
      init: function(pluginsDict, callback) {
        var instances, pluginPaths;
        pluginPaths = _.keys(pluginsDict);
        instances = {};
        return require(pluginPaths, function() {
          var plugins;
          plugins = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          _.each(plugins, function(plugin, i) {
            var instance, options;
            options = pluginsDict[pluginPaths[i]];
            instance = new plugin(options);
            instance.init(instances);
            return instances[pluginPaths[i]] = instance;
          });
          window.instances = instances;
          if (callback != null) {
            return callback(instances);
          }
        });
      }
    };
  });

}).call(this);
